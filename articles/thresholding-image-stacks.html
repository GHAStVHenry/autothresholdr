<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thresholding Image Stacks • autothresholdr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Thresholding Image Stacks">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">autothresholdr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/finding-thresholds.html">Finding Thresholds</a>
    </li>
    <li>
      <a href="../articles/thresholding-image-stacks.html">Thresholding Image Stacks</a>
    </li>
    <li>
      <a href="../articles/thresholding-images.html">Thresholding Images</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Thresholding Image Stacks</h1>
            
            <h4 class="date">2019-05-29</h4>
      
      
      <div class="hidden name"><code>thresholding-image-stacks.Rmd</code></div>

    </div>

    
    
<div id="stacks-of-images" class="section level2">
<h2 class="hasAnchor">
<a href="#stacks-of-images" class="anchor"></a>Stacks of Images</h2>
<p><code>50.tif</code> is a TIFF file which is a stack of 50 images of a bit of a cell taken over a short space of time (i.e. it’s a video).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">img &lt;-<span class="st"> </span>ijtiff<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ijtiff/topics/read_tif">read_tif</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata"</span>, <span class="st">"50.tif"</span>, </a>
<a class="sourceLine" id="cb1-2" data-line-number="2">                                    <span class="dt">package =</span> <span class="st">"autothresholdr"</span>))</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Reading 50.tif: an 8-bit, 100x100 pixel image of unsigned</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; integer type with 1 channel and 50 frames . . .</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt;  Done.</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/dim">dim</a></span>(img)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; [1] 100 100   1  50</span></a></code></pre></div>
<p>Let’s display the first 3 frames:</p>
<pre><code>#&gt; Using basic display functionality.
#&gt;   * For better display functionality, install the EBImage package.
#&gt;   * To install `EBImage`:
#&gt;     - Install `BiocManager` with `install.packages("BiocManager")`.
#&gt;     - Then run `BiocManager::install("EBImage")`.</code></pre>
<p><img src="thresholding-image-stacks_files/figure-html/first-3-frames-1.png" width="672"></p>
<p>and the last 3 frames:</p>
<pre><code>#&gt; Using basic display functionality.
#&gt;   * For better display functionality, install the EBImage package.
#&gt;   * To install `EBImage`:
#&gt;     - Install `BiocManager` with `install.packages("BiocManager")`.
#&gt;     - Then run `BiocManager::install("EBImage")`.</code></pre>
<p><img src="thresholding-image-stacks_files/figure-html/last-3-frames-1.png" width="672"></p>
<p>You’ll notice that these images are almost identical. That’s because they’re images of the same area taken very quickly one after another. There are two ways to threshold an image stack like this. One is the naiive way: find a threshold based on every pixel in the stack, then pixels below the threshold are excluded (set to <code>NA</code>). Let’s try that:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(autothresholdr)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">naiively_threshed_img &lt;-<span class="st"> </span><span class="kw"><a href="../reference/auto_thresh.html">apply_mask</a></span>(img, <span class="st">"tri"</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(naiively_threshed_img, <span class="st">"thresh"</span>)  <span class="co"># The threshold chosen by "Triangle" is 4</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; [1] 4</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; attr(,"ignore_black")</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; attr(,"ignore_white")</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; attr(,"ignore_na")</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; attr(,"autothresh_method")</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; [1] "Triangle"</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; attr(,"class")</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; [1] "th"      "integer"</span></a></code></pre></div>
<p>Now let’s display the first 3 frames and the last 3 frames:</p>
<pre><code>#&gt; Using basic display functionality.
#&gt;   * For better display functionality, install the EBImage package.
#&gt;   * To install `EBImage`:
#&gt;     - Install `BiocManager` with `install.packages("BiocManager")`.
#&gt;     - Then run `BiocManager::install("EBImage")`.</code></pre>
<p><img src="thresholding-image-stacks_files/figure-html/naiive-first-3-frames-1.png" width="672"></p>
<pre><code>#&gt; Using basic display functionality.
#&gt;   * For better display functionality, install the EBImage package.
#&gt;   * To install `EBImage`:
#&gt;     - Install `BiocManager` with `install.packages("BiocManager")`.
#&gt;     - Then run `BiocManager::install("EBImage")`.</code></pre>
<p><img src="thresholding-image-stacks_files/figure-html/naiive-last-3-frames-1.png" width="672"></p>
<p>If you look closely, you can see that the threshold mask is (slightly) different for different frames. Let’s highlight the pixels which are sometimes thresholded away, sometimes not:</p>
<pre><code>#&gt; Using basic display functionality.
#&gt;   * For better display functionality, install the EBImage package.
#&gt;   * To install `EBImage`:
#&gt;     - Install `BiocManager` with `install.packages("BiocManager")`.
#&gt;     - Then run `BiocManager::install("EBImage")`.</code></pre>
<p><img src="thresholding-image-stacks_files/figure-html/sometimes-sometimes-not-1.png" width="672"></p>
<p>So (unsurprisingly), it seems that around the edges of the cell (where the signal from the cell is more feint), the pixels are sometimes thresholded away, sometimes not. There are also some seemingly random pixels within the cell which are sometimes thresholded away, sometimes not.</p>
<p>Now, given that you know that the cell is more or less stationary and you want the threshold to get rid of the <em>non-cell</em> bits and keep the <em>cell</em> bits, its reasonable to assert that the mask should be the same for every frame. It’s possible to apply the same mask to every frame, and to compute this mask, it makes sense to incorporate information from all of the frames. This is what <code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code> and <code><a href="../reference/med_stack_thresh.html">med_stack_thresh()</a></code> do. <code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code> computes the mask based on the mean of all of the frames (gotten by calculating the mean intensity of the stack at each pixel position). <code><a href="../reference/med_stack_thresh.html">med_stack_thresh()</a></code> uses the median instead of the mean. They’re both very similar. If you don’t know which one to use, just use <code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code>.</p>
<p>Let’s visualize them both:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">ijtiff<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ijtiff/topics/display">display</a></span>(<span class="kw"><a href="../reference/mean_stack_thresh.html">mean_stack_thresh</a></span>(img, <span class="st">"tri"</span>))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; Using basic display functionality.</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co">#&gt;   * For better display functionality, install the EBImage package.</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt;   * To install `EBImage`:</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="co">#&gt;     - Install `BiocManager` with `install.packages("BiocManager")`.</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co">#&gt;     - Then run `BiocManager::install("EBImage")`.</span></a></code></pre></div>
<p><img src="thresholding-image-stacks_files/figure-html/stack-threshs-1.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">ijtiff<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/ijtiff/topics/display">display</a></span>(<span class="kw"><a href="../reference/med_stack_thresh.html">med_stack_thresh</a></span>(img, <span class="st">"tri"</span>))</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#&gt; Using basic display functionality.</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt;   * For better display functionality, install the EBImage package.</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#&gt;   * To install `EBImage`:</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#&gt;     - Install `BiocManager` with `install.packages("BiocManager")`.</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#&gt;     - Then run `BiocManager::install("EBImage")`.</span></a></code></pre></div>
<p><img src="thresholding-image-stacks_files/figure-html/stack-threshs-2.png" width="672"></p>
<p>You can see that the results of <code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code> and <code><a href="../reference/med_stack_thresh.html">med_stack_thresh()</a></code> are similar but not identical. Both do a fine job.</p>
<p>Note that if the cell (or whatever is recorded over the course of several frames) is not stationary (or almost stationary), then <code><a href="../reference/mean_stack_thresh.html">mean_stack_thresh()</a></code> and <code><a href="../reference/med_stack_thresh.html">med_stack_thresh()</a></code> are not appropriate.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#stacks-of-images">Stacks of Images</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Rory Nolan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
